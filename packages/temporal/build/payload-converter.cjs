"use strict";var _=Object.defineProperty;var Pe=Object.getOwnPropertyDescriptor;var Re=Object.getOwnPropertyNames;var Se=Object.prototype.hasOwnProperty;var Ae=(e,t)=>{for(var r in t)_(e,r,{get:t[r],enumerable:!0})},Ne=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Re(t))!Se.call(e,s)&&s!==r&&_(e,s,{get:()=>t[s],enumerable:!(n=Pe(t,s))||n.enumerable});return e};var ke=e=>Ne(_({},"__esModule",{value:!0}),e);var $e={};Ae($e,{payloadConverter:()=>Fe});module.exports=ke($e);var j=require("@temporalio/common");var M=require("@temporalio/common");var k=class{constructor(){this.keyToValue=new Map,this.valueToKey=new Map}set(t,r){this.keyToValue.set(t,r),this.valueToKey.set(r,t)}getByKey(t){return this.keyToValue.get(t)}getByValue(t){return this.valueToKey.get(t)}clear(){this.keyToValue.clear(),this.valueToKey.clear()}};var b=class{constructor(t){this.generateIdentifier=t,this.kv=new k}register(t,r){this.kv.getByValue(t)||(r||(r=this.generateIdentifier(t)),this.kv.set(r,t))}clear(){this.kv.clear()}getIdentifier(t){return this.kv.getByValue(t)}getValue(t){return this.kv.getByKey(t)}};var I=class extends b{constructor(){super(t=>t.name),this.classToAllowedProps=new Map}register(t,r){typeof r=="object"?(r.allowProps&&this.classToAllowedProps.set(t,r.allowProps),super.register(t,r.identifier)):super.register(t,r)}getAllowedProps(t){return this.classToAllowedProps.get(t)}};function Ie(e){if("values"in Object)return Object.values(e);let t=[];for(let r in e)e.hasOwnProperty(r)&&t.push(e[r]);return t}function Z(e,t){let r=Ie(e);if("find"in r)return r.find(t);let n=r;for(let s=0;s<n.length;s++){let o=n[s];if(t(o))return o}}function g(e,t){Object.entries(e).forEach(([r,n])=>t(n,r))}function E(e,t){return e.indexOf(t)!==-1}function q(e,t){for(let r=0;r<e.length;r++){let n=e[r];if(t(n))return n}}var T=class{constructor(){this.transfomers={}}register(t){this.transfomers[t.name]=t}findApplicable(t){return Z(this.transfomers,r=>r.isApplicable(t))}findByName(t){return this.transfomers[t]}};var Te=e=>Object.prototype.toString.call(e).slice(8,-1),K=e=>typeof e>"u",ve=e=>e===null,h=e=>typeof e!="object"||e===null||e===Object.prototype?!1:Object.getPrototypeOf(e)===null?!0:Object.getPrototypeOf(e)===Object.prototype,v=e=>h(e)&&Object.keys(e).length===0,l=e=>Array.isArray(e),Ve=e=>typeof e=="string",Ue=e=>typeof e=="number"&&!isNaN(e),Ce=e=>typeof e=="boolean",J=e=>e instanceof RegExp,y=e=>e instanceof Map,d=e=>e instanceof Set,F=e=>Te(e)==="Symbol",ee=e=>e instanceof Date&&!isNaN(e.valueOf()),te=e=>e instanceof Error,$=e=>typeof e=="number"&&isNaN(e),re=e=>Ce(e)||ve(e)||K(e)||Ue(e)||Ve(e)||F(e),ne=e=>typeof e=="bigint",se=e=>e===1/0||e===-1/0,oe=e=>ArrayBuffer.isView(e)&&!(e instanceof DataView),ie=e=>e instanceof URL;var L=e=>e.replace(/\./g,"\\."),V=e=>e.map(String).map(L).join("."),O=e=>{let t=[],r="";for(let s=0;s<e.length;s++){let o=e.charAt(s);if(o==="\\"&&e.charAt(s+1)==="."){r+=".",s++;continue}if(o==="."){t.push(r),r="";continue}r+=o}let n=r;return t.push(n),t};function p(e,t,r,n){return{isApplicable:e,annotation:t,transform:r,untransform:n}}var ae=[p(K,"undefined",()=>null,()=>{}),p(ne,"bigint",e=>e.toString(),e=>typeof BigInt<"u"?BigInt(e):(console.error("Please add a BigInt polyfill."),e)),p(ee,"Date",e=>e.toISOString(),e=>new Date(e)),p(te,"Error",(e,t)=>{let r={name:e.name,message:e.message};return t.allowedErrorProps.forEach(n=>{r[n]=e[n]}),r},(e,t)=>{let r=new Error(e.message);return r.name=e.name,r.stack=e.stack,t.allowedErrorProps.forEach(n=>{r[n]=e[n]}),r}),p(J,"regexp",e=>""+e,e=>{let t=e.slice(1,e.lastIndexOf("/")),r=e.slice(e.lastIndexOf("/")+1);return new RegExp(t,r)}),p(d,"set",e=>[...e.values()],e=>new Set(e)),p(y,"map",e=>[...e.entries()],e=>new Map(e)),p(e=>$(e)||se(e),"number",e=>$(e)?"NaN":e>0?"Infinity":"-Infinity",Number),p(e=>e===0&&1/e===-1/0,"number",()=>"-0",Number),p(ie,"URL",e=>e.toString(),e=>new URL(e))];function U(e,t,r,n){return{isApplicable:e,annotation:t,transform:r,untransform:n}}var ue=U((e,t)=>F(e)?!!t.symbolRegistry.getIdentifier(e):!1,(e,t)=>["symbol",t.symbolRegistry.getIdentifier(e)],e=>e.description,(e,t,r)=>{let n=r.symbolRegistry.getValue(t[1]);if(!n)throw new Error("Trying to deserialize unknown symbol");return n}),ze=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,Uint8ClampedArray].reduce((e,t)=>(e[t.name]=t,e),{}),ce=U(oe,e=>["typed-array",e.constructor.name],e=>[...e],(e,t)=>{let r=ze[t[1]];if(!r)throw new Error("Trying to deserialize unknown typed array");return new r(e)});function W(e,t){return e?.constructor?!!t.classRegistry.getIdentifier(e.constructor):!1}var fe=U(W,(e,t)=>["class",t.classRegistry.getIdentifier(e.constructor)],(e,t)=>{let r=t.classRegistry.getAllowedProps(e.constructor);if(!r)return{...e};let n={};return r.forEach(s=>{n[s]=e[s]}),n},(e,t,r)=>{let n=r.classRegistry.getValue(t[1]);if(!n)throw new Error(`Trying to deserialize unknown class '${t[1]}' - check https://github.com/blitz-js/superjson/issues/116#issuecomment-773996564`);return Object.assign(Object.create(n.prototype),e)}),le=U((e,t)=>!!t.customTransformerRegistry.findApplicable(e),(e,t)=>["custom",t.customTransformerRegistry.findApplicable(e).name],(e,t)=>t.customTransformerRegistry.findApplicable(e).serialize(e),(e,t,r)=>{let n=r.customTransformerRegistry.findByName(t[1]);if(!n)throw new Error("Trying to deserialize unknown custom value");return n.deserialize(e)}),Be=[fe,ue,le,ce],G=(e,t)=>{let r=q(Be,s=>s.isApplicable(e,t));if(r)return{value:r.transform(e,t),type:r.annotation(e,t)};let n=q(ae,s=>s.isApplicable(e,t));if(n)return{value:n.transform(e,t),type:n.annotation}},pe={};ae.forEach(e=>{pe[e.annotation]=e});var me=(e,t,r)=>{if(l(t))switch(t[0]){case"symbol":return ue.untransform(e,t,r);case"class":return fe.untransform(e,t,r);case"custom":return le.untransform(e,t,r);case"typed-array":return ce.untransform(e,t,r);default:throw new Error("Unknown transformation: "+t)}else{let n=pe[t];if(!n)throw new Error("Unknown transformation: "+t);return n.untransform(e,r)}};var x=(e,t)=>{if(t>e.size)throw new Error("index out of bounds");let r=e.keys();for(;t>0;)r.next(),t--;return r.next().value};function ye(e){if(E(e,"__proto__"))throw new Error("__proto__ is not allowed as a property");if(E(e,"prototype"))throw new Error("prototype is not allowed as a property");if(E(e,"constructor"))throw new Error("constructor is not allowed as a property")}var de=(e,t)=>{ye(t);for(let r=0;r<t.length;r++){let n=t[r];if(d(e))e=x(e,+n);else if(y(e)){let s=+n,o=+t[++r]==0?"key":"value",a=x(e,s);switch(o){case"key":e=a;break;case"value":e=e.get(a);break}}else e=e[n]}return e},C=(e,t,r)=>{if(ye(t),t.length===0)return r(e);let n=e;for(let o=0;o<t.length-1;o++){let a=t[o];if(l(n)){let u=+a;n=n[u]}else if(h(n))n=n[a];else if(d(n)){let u=+a;n=x(n,u)}else if(y(n)){if(o===t.length-2)break;let c=+a,N=+t[++o]==0?"key":"value",w=x(n,c);switch(N){case"key":n=w;break;case"value":n=n.get(w);break}}}let s=t[t.length-1];if(l(n)?n[+s]=r(n[+s]):h(n)&&(n[s]=r(n[s])),d(n)){let o=x(n,+s),a=r(o);o!==a&&(n.delete(o),n.add(a))}if(y(n)){let o=+t[t.length-2],a=x(n,o);switch(+s==0?"key":"value"){case"key":{let c=r(a);n.set(c,n.get(a)),c!==a&&n.delete(a);break}case"value":{n.set(a,r(n.get(a)));break}}}return e};function Y(e,t,r=[]){if(!e)return;if(!l(e)){g(e,(o,a)=>Y(o,t,[...r,...O(a)]));return}let[n,s]=e;s&&g(s,(o,a)=>{Y(o,t,[...r,...O(a)])}),t(n,r)}function ge(e,t,r){return Y(t,(n,s)=>{e=C(e,s,o=>me(o,n,r))}),e}function he(e,t){function r(n,s){let o=de(e,O(s));n.map(O).forEach(a=>{e=C(e,a,()=>o)})}if(l(t)){let[n,s]=t;n.forEach(o=>{e=C(e,O(o),()=>e)}),s&&g(s,r)}else g(t,r);return e}var De=(e,t)=>h(e)||l(e)||y(e)||d(e)||W(e,t);function Me(e,t,r){let n=r.get(e);n?n.push(t):r.set(e,[t])}function we(e,t){let r={},n;return e.forEach(s=>{if(s.length<=1)return;t||(s=s.map(u=>u.map(String)).sort((u,c)=>u.length-c.length));let[o,...a]=s;o.length===0?n=a.map(V):r[V(o)]=a.map(V)}),n?v(r)?[n]:[n,r]:v(r)?void 0:r}var H=(e,t,r,n,s=[],o=[],a=new Map)=>{let u=re(e);if(!u){Me(e,s,t);let m=a.get(e);if(m)return n?{transformedValue:null}:m}if(!De(e,r)){let m=G(e,r),f=m?{transformedValue:m.value,annotations:[m.type]}:{transformedValue:e};return u||a.set(e,f),f}if(E(o,e))return{transformedValue:null};let c=G(e,r),N=c?.value??e,w=l(N)?[]:{},R={};g(N,(m,f)=>{if(f==="__proto__"||f==="constructor"||f==="prototype")throw new Error(`Detected property ${f}. This is a prototype pollution risk, please remove it from your object.`);let S=H(m,t,r,n,[...s,f],[...o,e],a);w[f]=S.transformedValue,l(S.annotations)?R[f]=S.annotations:h(S.annotations)&&g(S.annotations,(Oe,xe)=>{R[L(f)+"."+xe]=Oe})});let X=v(R)?{transformedValue:w,annotations:c?[c.type]:void 0}:{transformedValue:w,annotations:c?[c.type,R]:R};return u||a.set(e,X),X};function z(e){return Object.prototype.toString.call(e).slice(8,-1)}function Q(e){return z(e)==="Array"}function be(e){if(z(e)!=="Object")return!1;let t=Object.getPrototypeOf(e);return!!t&&t.constructor===Object&&t===Object.prototype}function je(e){return z(e)==="Null"}function _e(e,t,r,n,s){return o=>e(o)||t(o)||!!r&&r(o)||!!n&&n(o)||!!s&&s(o)}function qe(e){return z(e)==="Undefined"}var dt=_e(je,qe);function Ke(e,t,r,n,s){let o={}.propertyIsEnumerable.call(n,t)?"enumerable":"nonenumerable";o==="enumerable"&&(e[t]=r),s&&o==="nonenumerable"&&Object.defineProperty(e,t,{value:r,enumerable:!1,writable:!0,configurable:!0})}function B(e,t={}){if(Q(e))return e.map(s=>B(s,t));if(!be(e))return e;let r=Object.getOwnPropertyNames(e),n=Object.getOwnPropertySymbols(e);return[...r,...n].reduce((s,o)=>{if(Q(t.props)&&!t.props.includes(o))return s;let a=e[o],u=B(a,t);return Ke(s,o,u,e,t.nonenumerable),s},{})}var i=class{constructor({dedupe:t=!1}={}){this.classRegistry=new I,this.symbolRegistry=new b(r=>r.description??""),this.customTransformerRegistry=new T,this.allowedErrorProps=[],this.dedupe=t}serialize(t){let r=new Map,n=H(t,r,this,this.dedupe),s={json:n.transformedValue};n.annotations&&(s.meta={...s.meta,values:n.annotations});let o=we(r,this.dedupe);return o&&(s.meta={...s.meta,referentialEqualities:o}),s}deserialize(t){let{json:r,meta:n}=t,s=B(r);return n?.values&&(s=ge(s,n.values,this)),n?.referentialEqualities&&(s=he(s,n.referentialEqualities)),s}stringify(t){return JSON.stringify(this.serialize(t))}parse(t){return this.deserialize(JSON.parse(t))}registerClass(t,r){this.classRegistry.register(t,r)}registerSymbol(t,r){this.symbolRegistry.register(t,r)}registerCustom(t,r){this.customTransformerRegistry.register({name:r,...t})}allowErrorProps(...t){this.allowedErrorProps.push(...t)}};i.defaultInstance=new i;i.serialize=i.defaultInstance.serialize.bind(i.defaultInstance);i.deserialize=i.defaultInstance.deserialize.bind(i.defaultInstance);i.stringify=i.defaultInstance.stringify.bind(i.defaultInstance);i.parse=i.defaultInstance.parse.bind(i.defaultInstance);i.registerClass=i.defaultInstance.registerClass.bind(i.defaultInstance);i.registerSymbol=i.defaultInstance.registerSymbol.bind(i.defaultInstance);i.registerCustom=i.defaultInstance.registerCustom.bind(i.defaultInstance);i.allowErrorProps=i.defaultInstance.allowErrorProps.bind(i.defaultInstance);var Rt=i.serialize,St=i.deserialize,At=i.stringify,Nt=i.parse,kt=i.registerClass,It=i.registerCustom,Tt=i.registerSymbol,vt=i.allowErrorProps;var P=require("@temporalio/common/lib/encoding"),D=class{encodingType="json/plain";toPayload(t){if(t===void 0)return;let r="";try{r=i.stringify(t)}catch(n){throw new A(`Can't run SUPERJSON.stringify on this value: ${t}. Either convert it (or its properties) to SUPERJSON-serializable values (see https://github.com/flightcontrolhq/superjson#readme ), or create a custom data converter. SJSON.stringify error message: ${Ee(n)}`,n)}return{metadata:{[M.METADATA_ENCODING_KEY]:(0,P.encode)("json/plain"),format:(0,P.encode)("extended")},data:(0,P.encode)(r)}}fromPayload(t){try{if(!t.data)throw new A(`Can't run SUPERJSON.parse on this value: ${t.data}. Either convert it (or its properties) to SUPERJSON-serializable values (see https://github.com/flightcontrolhq/superjson#readme ), or create a custom data converter. No data found in payload.`);return i.parse((0,P.decode)(t.data))}catch(r){throw new A(`Can't run SUPERJSON.parse on this value: ${t.data}. Either convert it (or its properties) to SUPERJSON-serializable values (see https://github.com/flightcontrolhq/superjson#readme ), or create a custom data converter. SJSON.parse error message: ${Ee(r)}`,r)}}},A=class extends M.PayloadConverterError{constructor(r,n){super(r??void 0);this.cause=n}name="UnsupportedJsonTypeError"};function Ee(e){if(typeof e=="string")return e;if(e instanceof Error)return e.message}var Fe=new j.CompositePayloadConverter(new j.UndefinedPayloadConverter,new D);0&&(module.exports={payloadConverter});
